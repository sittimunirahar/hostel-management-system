/*! jQuery-Dynameter by Tzechiu Lei
*   http://tze1.com/dynameter/
*   v0.5.6
*   2014-06-13
*   Copyright (c) 2014 Tzechiu Lei.  MIT license. */

!function(a){a.fn.dynameter=function(b){var c={label:"DynaMeter",value:50,min:0,max:100,regions:{0:"normal"}},d=a.extend({},c,b);return d._range=d.max-d.min,d._clrRef0="normal",d._clrRef1="warn",d._clrRef2="error",this.changeValue=function(b){var c=a(this),d=c.data("dm-min"),e=c.data("dm-max"),f=c.data("dm-range");c.find(".dm-innerDiv .dm-valueP").html(b),d>b&&(b=d),b>e&&(b=e);var g=b-d,h=g/f*180;c.find(".dm-maskDiv").css({"-webkit-transform":"rotate("+h+"deg)","-moz-transform":"rotate("+h+"deg)","-ms-transform":"rotate("+h+"deg)","border-radius":"rotate("+h+"deg)"}),c.data("dm-value",b)},this.each(function(){function b(a){var b=c.data("dm-min"),d=c.data("dm-range");c.find(".dm-innerDiv .dm-valueP").html(a);var e=a-b,f=e/d*180;c.find(".dm-maskDiv").css({"-webkit-transform":"rotate("+f+"deg)","-ms-transform":"rotate("+f+"deg)","-moz-transform":"rotate("+f+"deg)","border-radius":"rotate("+f+"deg)"}),c.data("dm-value",a)}var c=a(this);if(!c.hasClass("dm-wrapperDiv")){if(d.value<d.min||d.value>d.max||d.min>=d.max)throw new Error("DynaMeter initialization failed -- invalid value/min/max settings.");var e;for(var f in d.regions){if(e=d.regions[f],e!=d._clrRef0&&e!=d._clrRef1&&e!=d._clrRef2)throw new Error("DynaMeter initialization failed -- invalid region color-key.");if(f<d.min||f>d.max)throw new Error("DynaMeter initialization failed -- invalid region value.")}c.addClass("dm-wrapperDiv"),c.data("dm-id","dm-"+(new Date).getTime()),c.data("dm-min",d.min),c.data("dm-max",d.max),c.data("dm-range",d.max-d.min),c.html(""),c.append('<div class="dm-maskDiv"></div>'),c.append('<div class="dm-innerDiv"></div>');var g=(c.find("div.dm-bgDiv"),c.find("div.dm-maskDiv"),c.find("div.dm-innerDiv"));g.append('<p class="dm-valueP">'+d.value+"</p>"),d.unit&&g.append('<p class="dm-unitP">'+d.unit+"</p>"),g.append('<p class="dm-labelP">'+d.label+"</p>");var h=(c.find("p.dm-valueP"),c.find("p.dm-unitP"),c.find("p.dm-labelP"),function(a){return a<d.min||a>d.max?null:parseInt((a-c.data("dm-min"))/c.data("dm-range")*180)}),i=[],j=0;for(var k in d.regions)0===j&&k>d.min&&(i.push([h(d.min),"normal"]),j++,"normal"==d.regions[k])||(i.push([h(k),d.regions[k]]),j++);for(var l=i.length,m=0;l>m;m++){var n=i[m][0],o=i[m][1];a(document.createElement("div")).addClass("dm-bgClrDiv "+o).css({"-webkit-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)",transform:"rotate("+n+"deg)",zIndex:m+1}).prependTo(c)}console.log("[dynameter] div#"+c.attr("id")+" initialized.")}b(d.value)})}}(jQuery);